{"version":3,"file":"authService.js","names":["generateJWT","user","data","email","signature","process","env","JWT_SECRET","expiration","jwt","sign","expiresIn","authService","generateToken","validateToken","token","decoded","verify","err","generateAndSend","redirect","toLowerCase","split","Error","cause","mailService","sendSignEmail"],"sources":["../../src/services/authService.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport mailService from './mailService';\n\nfunction generateJWT(user) {\n  const data = {\n    email: user.email,\n  };\n  \n  const signature = process.env.JWT_SECRET;\n  const expiration = '48h';\n\n  return jwt.sign({ data }, signature, { expiresIn: expiration });\n  }\n\nconst authService = {\n  generateToken: (user) => {\n    return generateJWT(user);\n  },\n\n  validateToken: (token) => {\n    const signature = process.env.JWT_SECRET;\n    let email;\n    try {\n      let decoded = jwt.verify(token, signature);\n      email = decoded.data.email;\n    } catch(err) {\n      throw err;\n    }\n    return email;\n  },\n\n  generateAndSend: async (redirect, email) => {\n    if(email.toLowerCase().split(\"@\")[1] != \"illinois.edu\"){\n      throw new Error(\"Email must end in @illinois.edu\", { cause: 'bad_email' });\n    }\n    // todo: actually send email\n    const token = generateJWT({email: email});\n    await mailService.sendSignEmail(redirect, email, token);\n  }\n}\n\nexport default authService;"],"mappings":";;;;;;;AAAA;AACA;AAAwC;AAAA,+CAAxC;AAAA;AAAA;AAEA,SAASA,WAAW,CAACC,IAAI,EAAE;EACzB,IAAMC,IAAI,GAAG;IACXC,KAAK,EAAEF,IAAI,CAACE;EACd,CAAC;EAED,IAAMC,SAAS,GAAGC,OAAO,CAACC,GAAG,CAACC,UAAU;EACxC,IAAMC,UAAU,GAAG,KAAK;EAExB,OAAOC,wBAAG,CAACC,IAAI,CAAC;IAAER,IAAI,EAAJA;EAAK,CAAC,EAAEE,SAAS,EAAE;IAAEO,SAAS,EAAEH;EAAW,CAAC,CAAC;AAC/D;AAEF,IAAMI,WAAW,GAAG;EAClBC,aAAa,EAAE,uBAACZ,IAAI,EAAK;IACvB,OAAOD,WAAW,CAACC,IAAI,CAAC;EAC1B,CAAC;EAEDa,aAAa,EAAE,uBAACC,KAAK,EAAK;IACxB,IAAMX,SAAS,GAAGC,OAAO,CAACC,GAAG,CAACC,UAAU;IACxC,IAAIJ,KAAK;IACT,IAAI;MACF,IAAIa,OAAO,GAAGP,wBAAG,CAACQ,MAAM,CAACF,KAAK,EAAEX,SAAS,CAAC;MAC1CD,KAAK,GAAGa,OAAO,CAACd,IAAI,CAACC,KAAK;IAC5B,CAAC,CAAC,OAAMe,GAAG,EAAE;MACX,MAAMA,GAAG;IACX;IACA,OAAOf,KAAK;EACd,CAAC;EAEDgB,eAAe;IAAA,kFAAE,iBAAOC,QAAQ,EAAEjB,KAAK;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,MAClCA,KAAK,CAACkB,WAAW,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,cAAc;gBAAA;gBAAA;cAAA;cAAA,MAC9C,IAAIC,KAAK,CAAC,iCAAiC,EAAE;gBAAEC,KAAK,EAAE;cAAY,CAAC,CAAC;YAAA;cAE5E;cACMT,KAAK,GAAGf,WAAW,CAAC;gBAACG,KAAK,EAAEA;cAAK,CAAC,CAAC;cAAA;cAAA,OACnCsB,uBAAW,CAACC,aAAa,CAACN,QAAQ,EAAEjB,KAAK,EAAEY,KAAK,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CACxD;IAAA;MAAA;IAAA;IAAA;EAAA;AACH,CAAC;AAAA,eAEcH,WAAW;AAAA"}